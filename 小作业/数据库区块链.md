# Report

> * 李佳政
> * 201828013229075

## 1. Introduction

### 1.1 区块链

区块链是分布式数据存储、点对点传输、共识机制、加密算法等计算机技术的新型应用模式。它本质上是一个去中介化的数据库，是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一次网络交易的信息，用于验证信息的有效性和生成下一区块。

### 1.2 Tendermint

它是一个能够保证多台机器数据安全一致地复制一个应用。安全，指的是即使有多达三分之一的机器出现任意故障的情况下，Tendermint仍然能正常工作。一致，指的是没一个正常工作的机器都会有着同样的交易日志，计算相同的状态。其中包含了一个区块链共识引擎，称为Tendermint Core，保证了每一台机器以相同的顺序记录同一笔交易，还包括一个ABCI服务。

### 1.3 ABCI

Application Block Chain Interface，保证了交易可以通过任何一种编程语言处理。

### 1.4 Gichain

gichain是对tendermint架构的区块链应用提供对外的逻辑。

## 2. 区块流程

验证者轮流获得提案区块的权力，每个验证者节点的权重根据算法计算得到。

当一个验证者节点获得了提案区块的权力后，开始区块流程。构造一个新的区块就是从内存池中选择已经check通过的交易打到区块中。
对区块进行投票，通过Gossip协议进行广播，其余区块对新生成的区块进行验证，当所有节点的都对区投票后通过，再使用Gossip协议通知其他节点和提案节点，超过三分之二的节点验证通过即为预投票通过，这符合Terminent的验证拜占庭错误损失接受程度，则这个区块被预确认。

> * Gossip
  Gossip协议，每个周期内，随机寻找其他节点同步彼此不知道的状态，从概率上说最终一定会收敛成所有的节点都拿到最新的状态，只不过节点越多，收敛越慢，最终会完成一致性。

使用Gossip协议通知其他节点预确认，在经过三分之二的权重的验证者认为这次预确认通过后，由验证者节点A(提案者)确认该去快，完成区块认证的操作，包括`BeginBlock`、`DeliverTx`、`EndBlock`、`Commit`操作。其余节点接收到Gossip信息后，也开始进行上述操作在本地确认区块，在本地数据库同样进行上述操作。
操作进行完毕后，重新进行区块提案，新的一轮投票确定提案权。

## 3. 交易流程

区块链中的交易指的是更新区块中数据的操作，所有的交易都需要在GiChain模块中的只能合约容器中进行，进行两次操作，一次是校验(checkTx, 也称背书)，一次为区块执行(包含BeginBlock, DeliverTx, endBlock, commit一系列流程)。校验通过并超过三分之二权重节点投票交易后才可以写入区块然后对写入区块的所有交易进行确认执行。

首先，客户端通过http请求tendermint core进行一笔交易，然后收到请求的节点进行校验背书，包括交易解析操作、验证签名、调用智能合约(执行智能合约代码，只是模拟执行而不真实修改数据库)，如果交易校验成功(可以执行)后，开始把交易信息广播给其他验证者节点。验证者开始进行背书校验，对交易进行检验，同样只是模拟执行，如果交易校验成功后，开始进行执行区块写入。当交易可以落到区块中时，开始进行节点投票，当超过三分之二权重节点投票通过后，开始保存当前区块信息。执行交易写入过程包括上述区块流程的四个操作，在`DeliverTx`操作中，包括交易解析、验证签名、调用智能合约接口。都是在ABCI服务器内执行的，完成`Commit`交易操作时，计算应用层状态Hash后提交状态数据库更新，随后把这次交易的Hash值存入区块中，在出第n+1块时，将第n块的执行结果写到第n+1块中。